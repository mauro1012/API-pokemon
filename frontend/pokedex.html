<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pok√©dex - API Consumption</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- üß≠ Header -->
  <header>
    <h1 id="welcomeMessage">Loading Pok√©dex...</h1>
    <button id="logoutButton" class="btn" style="background: var(--accent);">Log Out</button>
  </header>

  <!-- üì¶ Main -->
  <main>
    <section class="card" style="max-width: 600px; margin: 2rem auto;">
      <h2 style="color: var(--primary); margin-bottom: 1rem;">Pok√©mon Search</h2>

      <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1.5rem;">
        <input 
          type="text" 
          id="pokemonName" 
          placeholder="Enter Pok√©mon name or ID" 
          style="flex: 1; padding: 0.8rem; border: 1.5px solid var(--primary); border-radius: var(--radius); font-size: 1rem;"
        >
        <button onclick="fetchPokemon()" class="btn">Search</button>
      </div>

      <div id="pokemonData" style="margin-top: 1rem; border: 1px solid #ddd; border-radius: var(--radius); padding: 1rem; background: #fafafa;">
        <h3>Search Results:</h3>
      </div>
    </section>
  </main>

  <!-- ‚ö° Footer -->
  <footer>
    ¬© 2025 Pok√©Logs | Academic Project
  </footer>

  <script>
    const POKEAPI_BASE = 'https://pokeapi.co/api/v2/pokemon/';

    // 1Ô∏è‚É£ Check login status when page loads
    document.addEventListener('DOMContentLoaded', () => {
      const isLoggedIn = localStorage.getItem('isLoggedIn');
      const userEmail = localStorage.getItem('userEmail');

      if (isLoggedIn !== 'true') {
        window.location.href = 'index.html'; // Redirect to login if not authenticated
      } else {
        const userName = userEmail ? userEmail.split('@')[0] : 'Trainer';
        document.getElementById('welcomeMessage').textContent = `Welcome, ${userName}! Your Pok√©dex awaits.`;
      }
    });

    // 2Ô∏è‚É£ Logout Logic
    document.getElementById('logoutButton').addEventListener('click', () => {
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('userEmail');
      window.location.href = 'index.html';
    });

    // 3Ô∏è‚É£ Fetch Pok√©mon Data from Pok√©API
    async function fetchPokemon() {
      const nameOrId = document.getElementById('pokemonName').value.toLowerCase();
      const output = document.getElementById('pokemonData');
      output.innerHTML = '<h3>Searching...</h3>';

      if (!nameOrId) {
        output.innerHTML = '<h3>Please enter a Pok√©mon name or ID.</h3>';
        return;
      }

      try {
        const response = await fetch(POKEAPI_BASE + nameOrId);

        if (!response.ok) {
          if (response.status === 404) {
            output.innerHTML = '<h3>Pok√©mon not found! Please check the name or ID.</h3>';
            return;
          }
          throw new Error('Pok√©API error');
        }

        const data = await response.json();
        displayPokemon(data);
      } catch (error) {
        console.error('Error fetching Pok√©mon:', error);
        output.innerHTML = '<h3>There was an error fetching the Pok√©mon data.</h3>';
      }
    }

    // 4Ô∏è‚É£ Display Pok√©mon Information
    function displayPokemon(pokemon) {
      const output = document.getElementById('pokemonData');

      const types = pokemon.types.map(typeInfo => typeInfo.type.name).join(', ');
      const abilities = pokemon.abilities.map(abInfo => abInfo.ability.name).join(', ');
      const imageUrl = pokemon.sprites.front_default;

      output.innerHTML = `
        <h3>No. ${pokemon.id} - ${pokemon.name.toUpperCase()}</h3>
        <img src="${imageUrl}" alt="${pokemon.name}" style="width: 150px; height: 150px; image-rendering: pixelated;">
        <p><strong>Type(s):</strong> ${types}</p>
        <p><strong>Weight:</strong> ${(pokemon.weight / 10).toFixed(1)} kg</p>
        <p><strong>Abilities:</strong> ${abilities}</p>
      `;
    }
  </script>
</body>
</html>
